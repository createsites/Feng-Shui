$(document).ready(function(){$(".burger").on("click",function(){$(".info").slideToggle(300,function(){"none"===$(this).css("display")&&$(this).removeAttr("style")})});var t=$(".modal"),r=$("[data-toggle=modal]"),e=$(".modal__close");r.on("click",function(){t.toggleClass("modal--visible")}),e.on("click",function(){t.toggleClass("modal--visible")}),window.addEventListener("keydown",function(r){"27"==r.keyCode&&t.removeClass("modal--visible")},!1),$('a[href^="#"]').click(function(){return null!=document.getElementById($(this).attr("href").substr(1))&&$("html, body").animate({scrollTop:$($(this).attr("href")).offset().top-150},700),!1});var n=$(".header__head");$(window).scroll(function(){$(this).scrollTop()>400?n.addClass("fixd"):n.removeClass("fixd")});var o=$(".basket");$(window).scroll(function(){$(this).scrollTop()>400?o.addClass("fixd__basket"):o.removeClass("fixd__basket")});var i={add:function(t){i.products.push(t),i.refreshCookie(),i.refreshPrice(),i.addProductToOrder(t)},getPrice:function(){var t=0;return $.each(i.products,function(r,e){t+=parseInt(e.price)}),t},refreshPrice:function(){var t=i.getPrice();o.find(".total__price_amount").text(t),$("#modal__total__price_amount").text(t)},refreshOrder:function(){$("#modal__product_list").html(""),$.each(i.products,function(t,r){i.addProductToOrder(r)})},addProductToOrder:function(t){var r='        <div class="modal__product">\n          <div class="modal__product__img">\n            <img class="product__img" src="'+t.img+'" alt="#">\n          </div>\n          \x3c!-- /.modal__product__img --\x3e\n          <div class="modal__product__title">\n            <span class="modal__product__name">'+t.name+'</span>            <p class="modal__product__text modal__product__size_kind">'+t.sizeKind+'</p>\n            <p class="modal__product__text">'+t.structure+'</p>\n          </div>\n          \x3c!-- /.modal__product__title --\x3e\n          <div class="modal__buttom">\n            <button class="add add__plus">+</button>\n            <button class="add add__minus">&#8211</button>\n          </div>\n          \x3c!-- /.modal__buttom --\x3e\n          <div class="quantity"> Количество <br> <span class="lot">'+t.quantity+'</span> </div>\n          \x3c!-- /.quantity --\x3e\n          <div class="modal__price"> Стоимость <span class="cost">'+t.price+' р.</span></div>\n          \x3c!-- /.modal__price --\x3e\n          <div class="product__close"></div>\n      </div>';$("#modal__product_list").append(r)},searchProduct:function(t){for(var r=0;r<i.products.length;r++){var e=i.products[r];if(t.name===e.name&&t.sizeKind===e.sizeKind)return r}return!1},searchProductInOrder:function(t){var r=$(t).parents(".modal__product"),e={};return e.name=r.find(".modal__product__name").text().trim(),e.sizeKind=r.find(".modal__product__size_kind").text().trim(),e},getProductQuantity:function(t){var r=i.searchProduct(t);return!1!==r?i.products[r].quantity:0},changeQuantity:function(t,r){var e=i.products[t].price/i.products[t].quantity;i.products[t].price+=e*r,i.products[t].quantity+=r,i.refreshCookie(),i.refreshPrice(),i.refreshOrder()},removeProduct:function(t){i.products.splice(t,1),i.refreshCookie(),i.refreshPrice(),i.refreshOrder()},refreshCookie:function(){var t=JSON.stringify(i.products);$.cookie("basket",t,{path:"/"})}};$(".buy").click(function(){var t=$(this).parent(".size_kind");if(0===t.length)return console.log("Ошибка: у товара отсутствует размер"),!1;var r={};t.hasClass("small")?(r.sizeKind="стандарт",r.price=parseInt(t.find(".small__price").text().trim()),r.weight=t.find(".small__gramm").text().trim()):t.hasClass("big")&&(r.sizeKind="большой",r.price=parseInt(t.find(".big__price").text().trim()),r.weight=t.find(".big__gramm").text().trim());var e=$(t).parents(".wrap__product");r.name=e.find(".product__title").text().trim(),r.img=e.find(".product__img").attr("src"),r.structure=e.find(".product__structure").text().trim(),r.quantity=1;var n=i.searchProduct(r);!1===n?i.add(r):i.changeQuantity(n,1)}),$(document).on("click",".add__plus",function(){var t=i.searchProductInOrder(this),r=i.searchProduct(t);i.changeQuantity(r,1)}),$(document).on("click",".add__minus",function(){var t=i.searchProductInOrder(this),r=i.searchProduct(t);i.products[r].quantity>1&&i.changeQuantity(r,-1)}),$(document).on("click",".product__close",function(){var t=i.searchProductInOrder(this),r=i.searchProduct(t);i.removeProduct(r)}),i.products=null!=$.cookie("basket")?JSON.parse($.cookie("basket")):[],i.refreshPrice(),i.refreshOrder(),$("form").validate({errorClass:"invalid",rules:{userName:{required:!0,minlength:2,maxlength:15},userPhone:"required"},messages:{userName:{required:"Имя обязательно",minlength:"Имя не короче двух букв",maxlength:"Имя не длиннее 15 букв"},userPhone:"Телефон обязателен"}}),$("[type=tel]").mask("+7(000) 000-00-00",{placeholder:"+7 (___) ___-__-__"}),$(window).scroll(function(){$(this).scrollTop()>200?$("#button-up").fadeIn():$("#button-up").fadeOut()}),$("#button-up").click(function(){return $("body,html").animate({scrollTop:0},500),!1})});